version: 3

projects:
- dir: non-prod/stage/eu-west-1
  workflow: terragrunt
- dir: non-prod/stage/eu-west-2
  workflow: terragrunt
- dir: non-prod/stage/eu-west-3
  workflow: terragrunt
workflows:
  terragrunt:
    plan:
      steps:
      - run: terragrunt init-all -no-color
      - run: terragrunt plan-all -no-color -out "${PLANFILE}"
    apply:
      steps:
      - run: terragrunt apply-all -no-color "${PLANFILE}"